using Ambev.DeveloperEvaluation.Application.Sales.CreateSale;
using Ambev.DeveloperEvaluation.Domain.Entities;
using Ambev.DeveloperEvaluation.Domain.ValueObjects;
using Bogus;

namespace Ambev.DeveloperEvaluation.Functional.Sales.CreateSale;

/// <summary>
/// Provides factory methods to generate test data for
/// functional tests related to creating <see cref="Sale"/> entities via the API.
/// </summary>
/// <remarks>
/// This class centralizes the creation of valid <see cref="CreateSaleCommand"/>s and
/// their associated <see cref="CreateSaleItemCommand"/>s for functional testing.
/// It ensures consistency, readability, and reusability across tests that simulate
/// the creation of sales with multiple items.
/// </remarks>
public static class CreateSaleTestData
{
    private static readonly Faker Faker = new();
    
    /// <summary>
    /// Provides a <see cref="Bogus.Faker{T}"/> configured to generate valid <see cref="CreateSaleItemCommand"/> instances.
    /// Each generated item has a random ProductId, ProductName, Quantity, and UnitPrice.
    /// This ensures functional tests for sale creation have realistic items without manual setup.
    /// </summary>
    private static readonly Faker<CreateSaleItemCommand> SaleItemFaker =
        new Faker<CreateSaleItemCommand>()
            .RuleFor(i => i.ProductId, f => f.Random.Guid())
            .RuleFor(i => i.ProductName, f => f.Commerce.ProductName())
            .RuleFor(i => i.Quantity, f => f.Random.Int(1, 10))
            .RuleFor(i => i.UnitPrice, f => f.Random.Decimal(10, 500));

    /// <summary>
    /// Provides a <see cref="Bogus.Faker{T}"/> configured to generate valid <see cref="CreateSaleCommand"/> instances.
    /// Each command includes a random SaleNumber, CustomerId, CustomerName, SaleDate, BranchId, BranchName,
    /// and a list of 3 <see cref="CreateSaleItemCommand"/>s generated by <see cref="SaleItemFaker"/>.
    /// This ensures functional tests for sale creation have fully populated commands with realistic data.
    /// </summary>
    private static readonly Faker<CreateSaleCommand> SaleCommandFaker =
        new Faker<CreateSaleCommand>()
            .RuleFor(s => s.SaleNumber, f => f.Random.Replace("SALE-#####"))
            .RuleFor(s => s.CustomerId, f => f.Random.Guid())
            .RuleFor(s => s.CustomerName, f => f.Person.FullName)
            .RuleFor(s => s.SaleDate, f => f.Date.Recent())
            .RuleFor(s => s.BranchId, f => f.Random.Guid())
            .RuleFor(s => s.BranchName, f => f.Company.CompanyName())
            .RuleFor(s => s.Items, f => SaleItemFaker.Generate(3));

    /// <summary>
    /// Given no initial state
    /// When generating a new <see cref="CreateSaleCommand"/> for functional testing
    /// Then a fully populated command with multiple <see cref="CreateSaleItemCommand"/>s
    /// is returned, ready to be sent to the API for sale creation.
    /// </summary>
    /// <returns>A valid <see cref="CreateSaleCommand"/> with realistic test data.</returns>
    public static CreateSaleCommand GenerateValidCommand()
    {
        return SaleCommandFaker.Generate();
    }
}